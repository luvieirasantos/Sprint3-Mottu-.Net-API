# API Mottu ‚Äì Gest√£o de P√°tios, Funcion√°rios e Gerentes

> **3¬™ Sprint ‚Äì ADVANCED BUSINESS DEVELOPMENT WITH .NET**  
> Projeto em ASP.NET Core Web API seguindo boas pr√°ticas REST (pagina√ß√£o, HATEOAS, status codes adequados) e documenta√ß√£o via Swagger/OpenAPI.

---

## üë• Integrantes da Equipe
- Nome 1 ‚Äî RM: 558935 ‚Äî Lu Vieira Santos
- Nome 2 ‚Äî RM: 555656 ‚Äî Melissa Pereira
- Nome 3 ‚Äî RM: 558755 ‚Äî E‚Äëmail: Diego Furigo

---

## üß≠ Dom√≠nio e Justificativa
O dom√≠nio escolhido representa a **opera√ß√£o de p√°tios da Mottu**. H√° rela√ß√£o natural entre **p√°tios**, **funcion√°rios** e a **designa√ß√£o de gerentes** por p√°tio ‚Äî cen√°rio comum em opera√ß√µes log√≠sticas reais. Isso permite avaliar relacionamentos 1‚ÄëN e N‚ÄëN simples, al√©m de autentica√ß√£o e gest√£o de acesso futura.

### Entidades principais (m√≠nimo 3)
1. **P√°tio** (`Patio`) ‚Äì local f√≠sico onde motos/equipes operam.  
2. **Funcion√°rio** (`Funcionario`) ‚Äì usu√°rio operacional, alocado em um p√°tio.  
3. **Gerente** (`Gerente`) ‚Äì designa qual funcion√°rio gerencia um determinado p√°tio (rela√ß√£o Funcionario ‚Üî P√°tio).

> Essas 3 entidades cobrem o requisito de **‚Äúm√≠nimo 3 entidades principais‚Äù** e fazem sentido de neg√≥cio, pois a opera√ß√£o di√°ria depende de cadastro de p√°tios, quadro de pessoas e respons√°veis por cada p√°tio.

---

## üèóÔ∏è Arquitetura e Tecnologias
- **ASP.NET Core Web API** (.NET 9)  
- **Entity Framework Core** (mapeamento ORM)  
- **Banco**: *Oracle* (produ√ß√£o/aula) e op√ß√£o de **banco em mem√≥ria** no ambiente de desenvolvimento para facilitar testes locais (ver *Execu√ß√£o*).  
- **Swagger/OpenAPI** para documenta√ß√£o
- **Pagina√ß√£o** via `page` e `pageSize`
- **HATEOAS**: respostas incluem links de navega√ß√£o (cole√ß√µes e recursos) para facilitar descoberta de rotas
- **Camadas do projeto**
  - `Controllers/` ‚Äì entrada HTTP e contratos REST
  - `Data/` ‚Äì `DbContext`, mapeamentos e migra√ß√µes
  - `Models/` ‚Äì entidades de dom√≠nio e DTOs
  - `Migrations/` ‚Äì versionamento de esquema (EF Core)

> Justificativa: A separa√ß√£o por camadas simplifica manuten√ß√£o e testes, enquanto EF Core acelera o desenvolvimento seguro com Oracle. Swagger garante **transpar√™ncia dos contratos** e acelera QA.

---

## ‚ñ∂Ô∏è Execu√ß√£o (Dev e Produ√ß√£o)

### Pr√©‚Äërequisitos
- **Visual Studio 2022** (17.12+) ou **.NET 9 SDK** instalado
- Acesso ao Oracle (se for usar DB real) ou executar em **modo Dev** com banco em mem√≥ria

### 1) Clonar e restaurar
```bash
git clone <url-do-repo>
cd sprint3-.Net/MottuApi
dotnet restore
```

### 2) Definir ambiente e banco
**Modo r√°pido (DEV ‚Äì sem Oracle):**
- O projeto est√° configurado para rodar com banco **InMemory** quando `ASPNETCORE_ENVIRONMENT=Development`.  
- Nesse modo voc√™ j√° consegue abrir o Swagger e exercitar os endpoints.

**Modo com Oracle (produ√ß√£o/aula):**
1. Ajuste a connection string `DefaultConnection` no `appsettings.json`.
2. Aplique as migra√ß√µes:
   ```bash
   dotnet tool install --global dotnet-ef   # se ainda n√£o tiver
   dotnet ef database update
   ```

### 3) Rodar
```bash
dotnet run
```
- Logs mostram algo como: `Now listening on: http://localhost:5008`
- **Swagger UI**: por padr√£o est√° na **raiz** ‚Üí **http://localhost:5008/**
  - Se preferir em `/swagger`, altere `Program.cs` para `c.RoutePrefix = "swagger";` e acesse `http://localhost:5008/swagger`.
- HTTPS opcional: habilite no `launchSettings.json` (`applicationUrl` com http **e** https).

---

## üìò Swagger / OpenAPI
- **Descri√ß√£o de endpoints** e **par√¢metros** com anota√ß√µes
- **Exemplos de payload** inclu√≠dos
- **Modelos de dados** descritos
- Acesse a documenta√ß√£o interativa em **http://localhost:5008/** (ou `/swagger` se configurado)

---

## üîó Endpoints (CRUD + Pagina√ß√£o + HATEOAS + Autentica√ß√£o)

> **Pagina√ß√£o**: use `?page=1&pageSize=10`.  
> **HATEOAS**: as respostas incluem `links` com `rel`, `href` e `method` (exemplos abaixo).  
> **Status codes**: `200 OK`, `201 Created`, `204 No Content`, `400 Bad Request`, `404 Not Found`, `409 Conflict` (quando aplic√°vel).  
> **Autentica√ß√£o**: Sistema de login com hash de senha implementado.

### Autentica√ß√£o
- `POST /api/auth/login` ‚Äì Login de funcion√°rio

**Exemplo ‚Äì login**
```http
POST /api/auth/login
Content-Type: application/json

{
  "email": "joao.silva@mottu.com",
  "senha": "123456"
}
```

**Resposta 200**
```json
{
  "success": true,
  "message": "Login realizado com sucesso",
  "token": "base64-encoded-token",
  "funcionario": {
    "id": 1,
    "nome": "Jo√£o Silva",
    "email": "joao.silva@mottu.com",
    "patioId": 1,
    "patio": {
      "id": 1,
      "nome": "P√°tio Central",
      "endereco": "Rua das Flores, 123 - Centro"
    }
  }
}
```

### P√°tios
- `GET /api/patios` ‚Äì lista (pagina√ß√£o)
- `GET /api/patios/{id}` ‚Äì detalhe
- `POST /api/patios` ‚Äì cria
- `PUT /api/patios/{id}` ‚Äì atualiza
- `DELETE /api/patios/{id}` ‚Äì exclui

**Exemplo ‚Äì cria√ß√£o**
```http
POST /api/patios
Content-Type: application/json

{
  "nome": "P√°tio Central",
  "endereco": "Rua Principal, 123"
}
```
**Resposta 201**
```json
{
  "id": 1,
  "nome": "P√°tio Central",
  "endereco": "Rua Principal, 123",
  "links": [
    {"rel":"self","href":"/api/patios/1","method":"GET"},
    {"rel":"update","href":"/api/patios/1","method":"PUT"},
    {"rel":"delete","href":"/api/patios/1","method":"DELETE"}
  ]
}
```

### Funcion√°rios
- `GET /api/funcionarios` ‚Äì lista (pagina√ß√£o, sem exposi√ß√£o de senhas)
- `GET /api/funcionarios/{id}` ‚Äì detalhe (sem exposi√ß√£o de senha)
- `POST /api/funcionarios` ‚Äì cria (com hash autom√°tico de senha)
- `PUT /api/funcionarios/{id}` ‚Äì atualiza
- `DELETE /api/funcionarios/{id}` ‚Äì exclui

**Exemplo ‚Äì cria√ß√£o**
```http
POST /api/funcionarios
Content-Type: application/json

{
  "nome": "Jo√£o Silva",
  "email": "joao@mottu.com",
  "senha": "123456",
  "patioId": 1
}
```

**Resposta 201** (senha n√£o √© retornada por seguran√ßa)
```json
{
  "data": {
    "id": 1,
    "nome": "Jo√£o Silva",
    "email": "joao@mottu.com",
    "patioId": 1,
    "patio": {
      "id": 1,
      "nome": "P√°tio Central",
      "endereco": "Rua das Flores, 123 - Centro"
    }
  },
  "links": {
    "self": "/api/funcionarios/1",
    "update": "/api/funcionarios/1",
    "delete": "/api/funcionarios/1"
  }
}
```

### Gerentes
- `GET /api/gerentes`
- `GET /api/gerentes/{id}`
- `POST /api/gerentes`
- `PUT /api/gerentes/{id}`
- `DELETE /api/gerentes/{id}`

**Exemplo ‚Äì cria√ß√£o**
```http
POST /api/gerentes
Content-Type: application/json

{
  "funcionarioId": 1,
  "patioId": 1
}
```

---

## üõ†Ô∏è Exemplos de Uso com cURL

### Autentica√ß√£o
```bash
# Login
curl -X POST "http://localhost:5008/api/auth/login" \
     -H "Content-Type: application/json" \
     -d '{
       "email": "joao.silva@mottu.com",
       "senha": "123456"
     }'
```

### P√°tios
```bash
# Listar p√°tios (paginado)
curl -X GET "http://localhost:5008/api/patios?page=1&pageSize=10"

# Criar p√°tio
curl -X POST "http://localhost:5008/api/patios" \
     -H "Content-Type: application/json" \
     -d '{
       "nome": "P√°tio Central",
       "endereco": "Rua Principal, 123"
     }'

# Obter p√°tio por ID
curl -X GET "http://localhost:5008/api/patios/1"

# Atualizar p√°tio
curl -X PUT "http://localhost:5008/api/patios/1" \
     -H "Content-Type: application/json" \
     -d '{
       "id": 1,
       "nome": "P√°tio Central Atualizado",
       "endereco": "Rua Principal, 123"
     }'

# Excluir p√°tio
curl -X DELETE "http://localhost:5008/api/patios/1"
```

### Funcion√°rios
```bash
# Listar funcion√°rios (paginado)
curl -X GET "http://localhost:5008/api/funcionarios?page=1&pageSize=10"

# Criar funcion√°rio
curl -X POST "http://localhost:5008/api/funcionarios" \
     -H "Content-Type: application/json" \
     -d '{
       "nome": "Jo√£o Silva",
       "email": "joao@mottu.com",
       "senha": "123456",
       "patioId": 1
     }'

# Obter funcion√°rio por ID
curl -X GET "http://localhost:5008/api/funcionarios/1"

# Atualizar funcion√°rio
curl -X PUT "http://localhost:5008/api/funcionarios/1" \
     -H "Content-Type: application/json" \
     -d '{
       "id": 1,
       "nome": "Jo√£o Silva Atualizado",
       "email": "joao@mottu.com",
       "senha": "123456",
       "patioId": 1
     }'

# Excluir funcion√°rio
curl -X DELETE "http://localhost:5008/api/funcionarios/1"
```

### Gerentes
```bash
# Listar gerentes (paginado)
curl -X GET "http://localhost:5008/api/gerentes?page=1&pageSize=10"

# Criar gerente
curl -X POST "http://localhost:5008/api/gerentes" \
     -H "Content-Type: application/json" \
     -d '{
       "funcionarioId": 1,
       "patioId": 1
     }'

# Obter gerente por ID
curl -X GET "http://localhost:5008/api/gerentes/1"

# Atualizar gerente
curl -X PUT "http://localhost:5008/api/gerentes/1" \
     -H "Content-Type: application/json" \
     -d '{
       "id": 1,
       "funcionarioId": 1,
       "patioId": 1
     }'

# Excluir gerente
curl -X DELETE "http://localhost:5008/api/gerentes/1"
```

---

## üß™ Testes
Execute todos os testes do reposit√≥rio:
```bash
dotnet test
```

---

## üöÄ Melhorias Implementadas

### Seguran√ßa
- ‚úÖ **Hash de senhas** com SHA256 antes de salvar no banco
- ‚úÖ **DTOs de resposta** que n√£o exp√µem senhas
- ‚úÖ **Valida√ß√£o de email √∫nico** na cria√ß√£o de funcion√°rios
- ‚úÖ **Valida√ß√£o de p√°tio existente** na cria√ß√£o de funcion√°rios

### Autentica√ß√£o
- ‚úÖ **Sistema de login** com verifica√ß√£o de credenciais
- ‚úÖ **Gera√ß√£o de token** simples para autentica√ß√£o
- ‚úÖ **Servi√ßo de autentica√ß√£o** separado e reutiliz√°vel

### Dados de Exemplo
- ‚úÖ **Seed data** autom√°tico em desenvolvimento
- ‚úÖ **Dados pr√©-cadastrados** para testes
- ‚úÖ **Funcion√°rios de exemplo** com credenciais conhecidas

### Qualidade do C√≥digo
- ‚úÖ **Separa√ß√£o de responsabilidades** com servi√ßos
- ‚úÖ **DTOs espec√≠ficos** para cria√ß√£o e resposta
- ‚úÖ **Valida√ß√µes robustas** nos endpoints
- ‚úÖ **Tratamento de erros** adequado

## ‚úÖ Checklist vs. Requisitos do Professor

- [x] **3 entidades** principais (P√°tio, Funcion√°rio, Gerente) **com justificativa** de dom√≠nio
- [x] **CRUD** completo para as 3 entidades
- [x] **Boas pr√°ticas REST**: recursos, verbos, status codes e valida√ß√µes
- [x] **Pagina√ß√£o** (`page`, `pageSize`) em cole√ß√µes
- [x] **HATEOAS** para navega√ß√£o entre recursos
- [x] **Swagger/OpenAPI** com descri√ß√£o, par√¢metros, exemplos e modelos
- [x] **Reposit√≥rio GitHub p√∫blico** com **README** claro
- [x] **Comando para rodar testes** (`dotnet test`)
- [x] **Seguran√ßa** com hash de senhas e valida√ß√µes
- [x] **Autentica√ß√£o** b√°sica implementada

> **Penalidades que este README ajuda a evitar**  
> -20 pts ‚Äî falta de documenta√ß√£o Swagger ‚Ä¢ -100 pts ‚Äî projeto n√£o compila ‚Ä¢ -20 pts ‚Äî sem README

---

## üìÑ Licen√ßa
Uso acad√™mico. Ajuste conforme a pol√≠tica da disciplina.

